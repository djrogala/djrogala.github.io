<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TRS Tier II Pension Calculator</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="calculator-container">
    <div class="calculator">
      <h1>TRS Tier II Pension Calculator</h1>
      <p class="subtitle">Values shown in 2025 dollars</p>

      <!-- Inputs remain unchanged from previous version -->

      <div id="result">
        <h2>Estimated Monthly Pension (2025 Dollars):</h2>
        <p class="result-value"><strong>At Pension Collection:</strong> <span id="monthlyAmount">$---</span></p>
        
        <h3>Payments at Differing Ages:</h3>
        <ul class="projected-payments">
          <li><strong>Age 62*:</strong> <span id="age62">$---</span></li>
          <li><strong>Age 65*:</strong> <span id="age65">$---</span></li>
          <li><strong>Age 67:</strong> <span id="age67">$---</span></li>
          <li><strong>Age 75:</strong> <span id="age75">$---</span></li>
          <li><strong>Age 85:</strong> <span id="age85">$---</span></li>
        </ul>
      </div>

      <div class="fine-print">
        <p>*6% annual penalty applied once if collected before 67.</p>
        <p>Projections grow at 1.25% annually (½ CPI).</p>
      </div>

      <!-- Explanatory section remains unchanged -->
    </div>
  </div>

  <script>
    function calculatePension() {
      // Constants
      const INITIAL_CAP = 127283.01;
      const CAP_GROWTH = -0.0125; // Cap loses 1.25% purchasing power yearly
      const PENSION_GROWTH = 0.0125; // Pension grows at 1.25% yearly (½ CPI)
      const MULTIPLIER = 0.022;
      const FULL_RETIREMENT_AGE = 67;
      const EARLY_PENALTY = 0.06; // 6% per year

      // Get inputs
      const finalAvgSalary = parseFloat(document.getElementById('finalAvgSalary').value);
      const yearsOfService = parseFloat(document.getElementById('yearsOfService').value);
      const currentAge = parseFloat(document.getElementById('currentAge').value);
      const collectAge = parseFloat(document.getElementById('pensionCollectionAge').value);

      // Validate inputs
      if ([finalAvgSalary, yearsOfService, currentAge, collectAge].some(isNaN)) {
        alert("Please fill all fields with valid numbers.");
        return;
      }

      // Calculate initial pension
      const yearsUntilCollection = collectAge - currentAge;
      const collectionYear = 2025 + yearsUntilCollection;
      
      // Adjust cap
      const yearsFrom2025 = collectionYear - 2025;
      const adjustedCap = INITIAL_CAP * Math.pow(1 + CAP_GROWTH, yearsFrom2025);
      const cappedSalary = Math.min(finalAvgSalary, adjustedCap);

      // Base pension calculation
      let pension = (Math.min(yearsOfService, 35) * MULTIPLIER) * cappedSalary;
      pension = Math.min(pension, cappedSalary * 0.75); // 75% cap

      // Apply early penalty once
      if (collectAge < 67) {
        const penaltyYears = 67 - collectAge;
        pension *= Math.pow(1 - EARLY_PENALTY, penaltyYears);
      }

      // Store initial pension
      const initialMonthly = pension / 12;

      // Display results
      document.getElementById('monthlyAmount').textContent = `$${initialMonthly.toFixed(2)}`;

      // Calculate projections with growth
      const ages = [62, 65, 67, 75, 85];
      ages.forEach(age => {
        if (age < collectAge) return; // Can't project backwards
        
        const years = age - collectAge;
        let amount = initialMonthly * Math.pow(1 + PENSION_GROWTH, years);
        
        // Apply cap erosion for display purposes
        const capErosion = Math.pow(1 + CAP_GROWTH, years);
        amount *= capErosion;

        document.getElementById(`age${age}`).textContent = `$${amount.toFixed(2)}`;
      });
    }
  </script>
</body>
</html>
